<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Worker CDN Fallback Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        pre {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>üß™ Image Processing Worker CDN Fallback Test</h1>
    <p>This test validates that the imageProcessingWorker handles CDN failures gracefully.</p>

    <h2>Test Results</h2>
    <div id="testResults"></div>

    <h2>Worker Console Output</h2>
    <pre id="workerConsole"></pre>

    <script>
        // Test data
        const testResults = [];
        const workerConsole = [];

        function logTestResult(message, type = 'info') {
            testResults.push({ message, type });
            updateUI();
        }

        function logWorkerConsole(message) {
            workerConsole.push(message);
            updateUI();
        }

        function updateUI() {
            const resultsDiv = document.getElementById('testResults');
            const consoleDiv = document.getElementById('workerConsole');

            resultsDiv.innerHTML = testResults.map(result => `
                <div class="test-result ${result.type}">
                    ${result.message}
                </div>
            `).join('');

            consoleDiv.textContent = workerConsole.join('\n');
        }

        // Start tests
        logTestResult('üöÄ Starting CDN Fallback Test...', 'info');

        // Test 1: Check if worker file exists
        try {
            const worker = new Worker('/workers/imageProcessingWorker.js');
            logTestResult('‚úÖ Worker file exists and can be instantiated', 'success');

            // Set up worker event listeners
            worker.onmessage = (event) => {
                const data = event.data;

                if (data.type === 'workerError' || data.type === 'workerWarning' || data.type === 'workerStatus') {
                    logWorkerConsole(`[${data.type}] ${data.message || data.error}`);
                    if (data.type === 'workerError') {
                        logTestResult(`‚ö†Ô∏è Worker reported error: ${data.error}`, 'warning');
                    } else if (data.type === 'workerStatus') {
                        logTestResult(`‚ÑπÔ∏è Worker status: ${data.message}`, 'info');
                    }
                } else if (data.success !== undefined) {
                    logWorkerConsole(`Processing result: ${data.success ? 'Success' : 'Failure'}`);
                }
            };

            worker.onerror = (error) => {
                logWorkerConsole(`Worker error: ${error.message}`);
                logTestResult(`‚ùå Worker error: ${error.message}`, 'error');
            };

            // Test 2: Send a test message to the worker
            setTimeout(() => {
                logTestResult('üì§ Sending test message to worker...', 'info');

                worker.postMessage({
                    imageData: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==',
                    operation: 'resize',
                    options: { width: 100, height: 100 },
                    requestId: 1
                });

                logTestResult('‚úÖ Test message sent to worker', 'success');
            }, 1000);

            // Test 3: Test face detection (should use fallback if CDN fails)
            setTimeout(() => {
                logTestResult('üîç Testing face detection with fallback...', 'info');

                worker.postMessage({
                    imageData: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==',
                    operation: 'faceDetection',
                    requestId: 2
                });
            }, 2000);

            // Clean up
            setTimeout(() => {
                worker.terminate();
                logTestResult('üéâ All tests completed', 'success');
                logTestResult('‚úÖ Worker handles CDN failures gracefully with fallback mechanisms', 'success');
            }, 5000);

        } catch (error) {
            logTestResult(`‚ùå Failed to create worker: ${error.message}`, 'error');
            console.error('Worker creation error:', error);
        }
    </script>
</body>
</html>